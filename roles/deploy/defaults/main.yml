---
# Variable specification: maps variable suffixes to their default values
# null means no default (variable is optional), actual values are defaults
_app_var_specs:
  # Container basics
  image: null
  image_tag: 'latest'
  command: null
  entrypoint: null
  restart_policy: 'unless-stopped'
  pull: null
  recreate: null
  auto_remove: null

  # Networking
  networks: null
  network_mode: null
  ports: null
  hostname: null

  # Security
  capabilities: null
  security_opt: null
  privileged: null
  user: null
  sysctls: null

  # Runtime
  env: null
  labels: null
  devices: null
  volumes: null
  healthcheck: null

  # Dependencies and config
  deps: []
  deps_run: false
  configlist: []
  templatelist: []
  create_dirs: []
  finish: ''

# Resolve all app variables at once using custom filter
_app_vars: "{{ playbook_app | eliminyro.docker.resolve_app_vars(_app_var_specs, hostvars[inventory_hostname]) }}"

# Expose individual variables for backward compatibility with existing tasks
# Optional vars (null default) use .get() with omit fallback; required vars accessed directly
deploy_image: "{{ _app_vars.get('image', omit) }}"
deploy_image_tag: "{{ _app_vars.image_tag }}"
deploy_command: "{{ _app_vars.get('command', omit) }}"
deploy_entrypoint: "{{ _app_vars.get('entrypoint', omit) }}"
deploy_restart_policy: "{{ _app_vars.restart_policy }}"
deploy_pull: "{{ _app_vars.get('pull', omit) }}"
deploy_recreate: "{{ _app_vars.get('recreate', omit) }}"
deploy_auto_remove: "{{ _app_vars.get('auto_remove', omit) }}"
deploy_networks: "{{ _app_vars.get('networks', omit) }}"
deploy_network_mode: "{{ _app_vars.get('network_mode', omit) }}"
deploy_ports: "{{ _app_vars.get('ports', omit) }}"
deploy_hostname: "{{ _app_vars.get('hostname', omit) }}"
deploy_capabilities: "{{ _app_vars.get('capabilities', omit) }}"
deploy_security_opt: "{{ _app_vars.get('security_opt', omit) }}"
deploy_privileged: "{{ _app_vars.get('privileged', omit) }}"
deploy_user: "{{ _app_vars.get('user', omit) }}"
deploy_sysctls: "{{ _app_vars.get('sysctls', omit) }}"
deploy_env: "{{ _app_vars.get('env', omit) }}"
deploy_labels: "{{ _app_vars.get('labels', omit) }}"
deploy_devices: "{{ _app_vars.get('devices', omit) }}"
deploy_volumes: "{{ _app_vars.get('volumes', omit) }}"
deploy_healthcheck: "{{ _app_vars.get('healthcheck', omit) }}"
deploy_deps: "{{ _app_vars.deps }}"
deploy_deps_run: "{{ _app_vars.deps_run }}"
deploy_configlist: "{{ _app_vars.configlist }}"
deploy_templatelist: "{{ _app_vars.templatelist }}"
deploy_finish: "{{ _app_vars.finish }}"
